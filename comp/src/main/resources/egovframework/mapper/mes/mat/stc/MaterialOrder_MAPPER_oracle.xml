<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mes.mat.stc.service.MaterialOrderMapper">
	

	<resultMap id="materialOrder" type="mes.mat.stc.service.MaterialOrderVO">
		<result property="matOrdNum" column="MAT_ORD_NUM" />
		<result property="matComNum" column="MAT_COM_NUM" />
		<result property="matOrdDate" column="MAT_ORD_DATE" />
		<result property="matOrdOper" column="MAT_ORD_OPER" />
		<result property="matCode" column="MAT_CODE" />
		<result property="matComDate" column="MAT_COM_DATE" />
		<result property="operCode" column="OPER_CODE" />
		<result property="matVol" column="MAT_VOL" />
		<result property="matOrdVol" column="MAT_ORD_VOL" />
		<result property="matNordVol" column="MAT_NORD_VOL" />
		<result property="matOrdNote" column="MAT_ORD_NOTE" />
	</resultMap>
	
	<resultMap type="mes.mat.stc.service.MaterialVO" id="materialStock">
		<result property="lotNum" column="LOT_NUM" />
		<result property="matCode" column="MAT_CODE" />
		<result property="matVol" column="MAT_VOL" />
		<result property="matName" column="MAT_NAME" />
		<result property="matDiv" column="MAT_DIV" />
		<result property="matSafeStock" column="MAT_SAFE_STOCK" />
		<result property="matHisDVol" column="MAT_HIS_D_VOL" />
		<result property="matHisNum" column="MAT_HIS_NUM"/>
		<result property="matHisDate" column="MAT_HIS_DATE"/>
	</resultMap>
	
	<insert id="insertMaterialOrder">
		<![CDATA[
			INSERT INTO MATERIAL_ORDER 
				( MAT_ORD_NUM
				  , MAT_COM_NUM
				  , MAT_ORD_DATE
				  , MAT_ORD_OPER
				  , MAT_CODE
				  , MAT_COM_DATE
				  , OPER_CODE
				  , MAT_VOL
				  , MAT_ORD_VOL
				  , MAT_NORD_VOL
				  , MAT_ORD_NOTE )
			VALUES ( #{matOrdNum}
				  , #{matComNum}
				  , #{matOrdDate}
				  , #{matOrdOper}
				  , #{matCode}
				  , #{matComDate}
				  , #{operCode}
				  , #{matVol}
				  , #{matOrdVol}
				  , #{matNordVol}
				  , #{matOrdNote} )
		]]>
	</insert>
	
	<update id="updateMaterialOrder">
		<![CDATA[
			UPDATE MATERIAL_ORDER
			SET MAT_ORD_NUM=#{matOrdNum}
				, MAT_COM_NUM=#{matComNum}
				, MAT_ORD_DATE=#{matOrdDate}
				, MAT_ORD_OPER=#{matOrdOper}
				, MAT_CODE=#{matCode}
				, MAT_COM_DATE=#{matComDate}
				, OPER_CODE=#{operCode}
				, MAT_VOL=#{matVol}
				, MAT_ORD_VOL=#{matOrdVol}
				, MAT_NORD_VOL=#{matNordVol}
				, MAT_ORD_NOTE=#{matOrdNote}
						WHERE MAT_ORD_NUM=#{matOrdNum}
								AND MAT_COM_NUM=#{matComNum}
				]]>
	</update>
	
	<delete id="deleteMaterialOrder">
		<![CDATA[
			DELETE FROM MATERIAL_ORDER 
						WHERE MAT_ORD_NUM=#{matOrdNum}
								AND MAT_COM_NUM=#{matComNum}
				]]>
	</delete>
	
	<select id="selectMaterialOrder" resultType="mes.mat.stc.service.MaterialOrderVO">
		<![CDATA[
			SELECT
				MAT_ORD_NUM
				, MAT_COM_NUM
				, MAT_ORD_DATE
				, MAT_ORD_OPER
				, MAT_CODE
				, MAT_COM_DATE
				, OPER_CODE
				, MAT_VOL
				, MAT_ORD_VOL
				, MAT_NORD_VOL
				, MAT_ORD_NOTE
			FROM MATERIAL_ORDER
						WHERE MAT_ORD_NUM=#{matOrdNum}
								AND MAT_COM_NUM=#{matComNum}
				]]>
	</select>
	
	<select id="selectMaterialOrderList" parameterType="mes.mat.stc.service.MaterialOrderVO" resultType="egovMap">
SELECT * FROM (
	SELECT A.*, ROWNUM RNUM FROM (
				SELECT
								MAT_ORD_NUM
								, MAT_COM_NUM
								, MAT_ORD_DATE
								, MAT_ORD_OPER
								, MAT_CODE
								, MAT_COM_DATE
								, OPER_CODE
								, MAT_VOL
								, MAT_ORD_VOL
								, MAT_NORD_VOL
								, MAT_ORD_NOTE
						FROM MATERIAL_ORDER
				WHERE 1=1
				<if test="searchKeyword != null and searchKeyword != ''">
					<if test="searchCondition == 0">AND
						MAT_ORD_NUM = #{searchKeyword}
					</if>
					<if test="searchCondition == 1">AND
						MAT_COM_NUM LIKE '%' || #{searchKeyword} || '%'
					</if>
				</if>
					ORDER BY 
						MAT_ORD_NUM DESC
							, MAT_COM_NUM DESC
		
		<![CDATA[					
	) A WHERE ROWNUM <= #{lastIndex}
)WHERE RNUM > #{firstIndex}
]]>
	</select>	
	<select id="selectMaterialOrderListTotCnt" parameterType="mes.mat.stc.service.MaterialOrderVO" resultType="int">
			SELECT COUNT(*) totcnt
			FROM MATERIAL_ORDER
			WHERE 1=1
			<if test="searchKeyword != null and searchKeyword != ''">
				<if test="searchCondition == 0">AND
					MAT_ORD_NUM = #{searchKeyword}
				</if>
				<if test="searchCondition == 1">AND
					MAT_COM_NUM LIKE '%' || #{searchKeyword} || '%'
				</if>
			</if>
	</select>

</mapper>
