<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="mes.prd.com.service.impl.ProduceCommandDMapper">

	<insert id="insertProduceCommandD">
		<![CDATA[
			INSERT INTO PRODUCE_COMMAND_D 
				( PRD_COM_D_NUM
				  , PRD_COM_NUM
				  , MAT_CODE
				  , LOT_NUM
				  , ITM_CODE
				  , PRC_F_NO
				  , PRD_COM_VOL
				  , PRD_COM_D_DATE
				  , PRC_COM_NO
				  , PRC_COM_DIV
				  , MAT_VOL
				  , PRD_COM_NOTE
				  , DIV_MAT_CODE
				  , DIV_LOT_NUM
				  , PRD_PLAN_NUM )
			VALUES ( #{prdComDNum}
				  , #{prdComNum}
				  , #{matCode}
				  , #{lotNum}
				  , #{itmCode}
				  , #{prcFNo}
				  , #{prdComVol}
				  , #{prdComDDate}
				  , #{prcComNo}
				  , #{prcComDiv}
				  , #{matVol}
				  , #{prdComNote}
				  , #{divMatCode}
				  , #{divLotNum}
				  , #{prdPlanNum} )
		]]>
	</insert>

	<update id="updateProduceCommandD">
		<![CDATA[
			UPDATE PRODUCE_COMMAND_D
			SET PRD_COM_D_NUM=#{prdComDNum}
				, PRD_COM_NUM=#{prdComNum}
				, MAT_CODE=#{matCode}
				, LOT_NUM=#{lotNum}
				, ITM_CODE=#{itmCode}
				, PRC_F_NO=#{prcFNo}
				, PRD_COM_VOL=#{prdComVol}
				, PRD_COM_D_DATE=#{prdComDDate}
				, PRC_COM_NO=#{prcComNo}
				, PRC_COM_DIV=#{prcComDiv}
				, MAT_VOL=#{matVol}
				, PRD_COM_NOTE=#{prdComNote}
				, DIV_MAT_CODE=#{divMatCode}
				, DIV_LOT_NUM=#{divLotNum}
				, PRD_PLAN_NUM=#{prdPlanNum}
						WHERE PRD_COM_D_NUM=#{prdComDNum}
				]]>
	</update>

	<delete id="deleteProduceCommandD">
		<![CDATA[
			DELETE FROM PRODUCE_COMMAND_D 
						WHERE PRD_COM_D_NUM=#{prdComDNum}
				]]>
	</delete>

	<select id="selectProduceCommandD" resultType="mes.prd.com.service.ProduceCommandDVO">
		<![CDATA[
			SELECT
				PRD_COM_D_NUM
				, PRD_COM_NUM
				, MAT_CODE
				, LOT_NUM
				, ITM_CODE
				, PRC_F_NO
				, PRD_COM_VOL
				, PRD_COM_D_DATE
				, PRC_COM_NO
				, PRC_COM_DIV
				, MAT_VOL
				, PRD_COM_NOTE
				, DIV_MAT_CODE
				, DIV_LOT_NUM
				, PRD_PLAN_NUM
			FROM PRODUCE_COMMAND_D
						WHERE PRD_COM_D_NUM=#{prdComDNum}
				]]>
	</select>
	
	<!-- 작업지시 조회 -->
	<select id="selectProduceCommandList"
		parameterType="mes.prd.com.service.ProduceCommandDVO"
		resultType="mes.prd.com.service.ProduceCommandDVO">
		SELECT * FROM (
		SELECT A.*, ROWNUM RNUM FROM (
		select * from PRODUCE_COMMAND
		<where>
		<if test="prdComNum1 != null and prdComNum1 != ''">
				<![CDATA[	
					Prd_Com_Num < #{prdComNum1}
				]]>
		</if>
		</where>
		ORDER BY
		PRD_COM_NUM DESC
		
		<![CDATA[					
		) A WHERE ROWNUM <= 10)
		]]>
	</select>
	
	<!-- 작업지시디테일 조회 -->
	<select id="selectProduceCommandDList"
		parameterType="mes.prd.com.service.ProduceCommandDVO"
		resultType="mes.prd.com.service.ProduceCommandDVO">
		SELECT * FROM (
		SELECT A.*, ROWNUM RNUM FROM (
		select C.*, I.itm_name, OD.ord_num, OM.ord_delivery_date, 
		OD.ord_vol, I.itm_day_output
		from PRODUCE_COMMAND_d C, item I, order_d OD, order_m  OM
		where  c.itm_code = i.itm_code
        and c.ord_d_num = od.ord_d_num
        and od.ord_num = om.ord_num
        and C.prd_com_num = #{prdComNum}
		<if test="prdComDNum1 != null and prdComDNum1 != ''">
				<![CDATA[	
					and Prd_Com_D_Num > #{prdComDNum1}
				]]>
		</if>
		ORDER BY
		PRD_COM_D_NUM
		
		<![CDATA[					
		) A WHERE ROWNUM <= 10)
		]]>
	</select>
	
	<!-- 작업지시자재 조회 -->
	<select id="selectProduceCommandMatList"
		parameterType="mes.prd.com.service.ProduceCommandDVO"
		resultType="mes.prd.com.service.ProduceCommandDVO">
		SELECT * FROM (
		SELECT A.*, ROWNUM RNUM FROM (
		select *
		from PRODUCE_COMMAND_MAT
		where prd_com_d_num = #{prdComDNum}
		<if test="prdComDNum1 != null and prdComDNum1 != ''">
				<![CDATA[	
					and Prd_Com_Mat_Num > #{prdComMatNum}
				]]>
		</if>
		ORDER BY
		PRD_COM_MAT_NUM
		
		<![CDATA[					
		) A WHERE ROWNUM <= 10)
		]]>
	</select>

</mapper>
